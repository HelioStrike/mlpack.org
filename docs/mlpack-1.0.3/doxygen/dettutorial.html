<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MLPACK: Density Estimation Tree (DET) tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Density Estimation Tree (DET) tutorial </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="intro_det_tut"></a>
Introduction</h2>
<p>DETs perform the unsupervised task of density estimation using decision trees.</p>
<p>The details of this work is presented in the following paper: </p>
<div class="fragment"><pre class="fragment">@inproceedings{ram2011density,
  title={Density estimation trees},
  author={Ram, P. and Gray, A.G.},
  booktitle={Proceedings of the 17th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining},
  pages={627--635},
  year={2011},
  organization={ACM}
}
</pre></div><p><b>mlpack</b> provides:</p>
<ul>
<li>a <a class="el" href="dettutorial.html#cli_det_tut">simple command-line executable</a> to perform density estimation and related analyses using DETs</li>
<li>a <a class="el" href="dettutorial.html#dtree_det_tut">generic C++ class (DTree)</a> which provides various functionality for the DETs</li>
<li>a set of functions in the namespace <a class="el" href="dettutorial.html#dtutils_det_tut">mlpack::det</a> to perform cross-validation for the task of density estimation with DETs</li>
</ul>
<h2><a class="anchor" id="toc_det_tut"></a>
Table of Contents</h2>
<p>A list of all the sections this tutorial contains.</p>
<ul>
<li><a class="el" href="dettutorial.html#intro_det_tut">Introduction</a></li>
<li><a class="el" href="dettutorial.html#toc_det_tut">Table of Contents</a></li>
<li><a class="el" href="dettutorial.html#cli_det_tut">Command-Line 'dt_main'</a><ul>
<li><a class="el" href="dettutorial.html#cli_ex1_de_tut">Plain-vanilla density estimation</a></li>
<li><a class="el" href="dettutorial.html#cli_alt_reg_tut">Alternate DET regularization</a></li>
<li><a class="el" href="dettutorial.html#cli_ex2_de_test_tut">Estimation on a test set</a></li>
<li><a class="el" href="dettutorial.html#cli_ex3_de_p_tut">Printing a trained DET</a></li>
<li><a class="el" href="dettutorial.html#cli_ex4_de_vi_tut">Computing the variable importance</a></li>
<li><a class="el" href="dettutorial.html#cli_ex5_de_lm">Leaf Membership</a></li>
</ul>
</li>
<li><a class="el" href="dettutorial.html#dtree_det_tut">The 'DTree' class</a><ul>
<li><a class="el" href="dettutorial.html#dtree_pub_func_det_tut">Public Functions</a></li>
</ul>
</li>
<li><a class="el" href="dettutorial.html#dtutils_det_tut">'namespace mlpack::det'</a><ul>
<li><a class="el" href="dettutorial.html#dtutils_util_funcs">Utility Functions</a></li>
</ul>
</li>
<li><a class="el" href="dettutorial.html#further_doc_det_tut">Further Documentation</a></li>
</ul>
<h2><a class="anchor" id="cli_det_tut"></a>
Command-Line 'dt_main'</h2>
<p>The command line arguments of this program can be viewed using the '-h' option:</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -h

Density estimation with DET

  This program provides an example use of the Density Estimation Tree <span class="keywordflow">for</span>
  density estimation. For more details, please look at the paper titled <span class="stringliteral">&#39;Density</span>
<span class="stringliteral">  Estimation Trees&#39;</span>.

Required options:

  --input/training_set (-S) [string]
                                The data <span class="keyword">set</span> on which to perform density
                                estimation.

Options:

  --DET/max_leaf_size (-M) [int]
                                The maximum size of a leaf in the unpruned fully
                                grown DET.  Default value 10.
  --DET/min_leaf_size (-N) [int]
                                The minimum size of a leaf in the unpruned fully
                                grown DET.  Default value 5.
  --DET/use_volume_reg (-R)     This flag gives the used the option to use a
                                form of regularization similar to the usual
                                alpha-pruning in decision tree. But instead of
                                regularizing on the number of leaves, you
                                regularize on the sum of the inverse of the
                                volume of the leaves (meaning you penalize  low
                                volume leaves.
  --flag/print_tree (-P)        If you just wish to print the tree out on the
                                command line.
  --flag/print_vi (-I)          If you just wish to print the variable
                                importance of each feature out on the command
                                line.
  --help (-h)                   Default help info.
  --info [<span class="keywordtype">string</span>]               Get help on a specific module or option.
                                Default value &#39;&#39;.
  --input/labels (-L) [<span class="keywordtype">string</span>]  The labels for the given training data to
                                generate the class membership of each leaf (as
                                an extra statistic)  Default value &#39;&#39;.
  --input/test_set (-T) [<span class="keywordtype">string</span>]
                                An extra <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> of test points on which to estimate
                                the density given the estimator.  Default value
                                &#39;&#39;.
  --output/leaf_class_table (-l) [<span class="keywordtype">string</span>]
                                The file in which to output the leaf class
                                membership table.  Default value
                                &#39;leaf_class_membership.txt&#39;.
  --output/test_set_estimates (-t) [<span class="keywordtype">string</span>]
                                The file in which to output the estimates on the
                                test <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> from the final optimally pruned tree.
                                Default value &#39;&#39;.
  --output/training_set_estimates (-s) [<span class="keywordtype">string</span>]
                                The file in which to output the estimates on the
                                training <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> from the final optimally pruned
                                tree.  Default value &#39;&#39;.
  --output/tree (-p) [<span class="keywordtype">string</span>]   The file in which to print the final optimally
                                pruned tree.  Default value &#39;&#39;.
  --output/unpruned_tree_estimates (-u) [<span class="keywordtype">string</span>]
                                The file in which to output the estimates on the
                                training <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> from the large unpruned tree.
                                Default value &#39;&#39;.
  --output/vi (-i) [<span class="keywordtype">string</span>]     The file to output the variable importance
                                values for each feature.  Default value &#39;&#39;.
  --param/folds (-F) [<span class="keywordtype">int</span>]      The number of folds of cross-validation to
                                performed for the estimation (enter 0 for LOOCV)
                                 Default value 10.
  --param/number_of_classes (-C) [<span class="keywordtype">int</span>]
                                The number of classes present in the &#39;labels&#39;
                                <a class="code" href="core_2CMakeLists_8txt.html#a93eeac0373c5adff47af8f6851b7ec76">set</a> provided  Default value 0.
  --verbose (-v)                Display informational messages and the full list
                                of parameters and timers at the end of
                                execution.

For further information, including relevant papers, citations, and theory,
consult the documentation found at http:<span class="comment">//www.mlpack.org or included with your</span>
distribution of MLPACK.
</pre></div><h3><a class="anchor" id="cli_ex1_de_tut"></a>
Plain-vanilla density estimation</h3>
<p>We can just train a DET on the provided data set <em>S</em>. Like all datasets <b>mlpack</b> uses, the data should be row-major (<b>mlpack</b> transposes data when it is loaded; internally, the data is column-major -- see <a class="el" href="matrices.html">this page</a> for more information).</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -v
</pre></div><p>By default, dt_main performs 10-fold cross-validation (using the <img class="formulaInl" alt="$\alpha$" src="form_56.png"/>-pruning regularization for decision trees). To perform LOOCV (leave-one-out cross-validation), use the following command:</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -F 0 -v
</pre></div><p>To perform k-fold crossvalidation, use <code>-F</code> <code>k</code>. There are certain other options available for training. For example, for the construction of the initial tree, you can specify the maximum and minimum leaf sizes. By default, they are 10 and 5 respectively, you can set them using the <code>-M</code> (<code>--maximum_leaf_size</code>) and the <code>-N</code> (<code>--minimum_leaf_size</code>) options.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -M 20 -N 10
</pre></div><p>In case you want to output the density estimates at the points in the training set, use the <code>-s</code> option to specify the output file.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -s density_estimates.txt -v
</pre></div><h3><a class="anchor" id="cli_alt_reg_tut"></a>
Alternate DET regularization</h3>
<p>The usual regularized error <img class="formulaInl" alt="$R_\alpha(t)$" src="form_57.png"/> of a node <img class="formulaInl" alt="$t$" src="form_58.png"/> is given by: <img class="formulaInl" alt="$R_\alpha(t) = R(t) + \alpha |\tilde{t}|$" src="form_59.png"/> where <img class="formulaInl" alt="$R(t) = -\frac{|t|^2}{N^2 V(t)}$" src="form_60.png"/>. <img class="formulaInl" alt="$V(t)$" src="form_61.png"/> is the volume of the node <img class="formulaInl" alt="$t$" src="form_58.png"/> and <img class="formulaInl" alt="$\tilde{t}$" src="form_62.png"/> is the set of leaves in the subtree rooted at <img class="formulaInl" alt="$t$" src="form_58.png"/>.</p>
<p>For the purposes of density estimation, I have developed a different form of regularization -- instead of penalizing the number of leaves in the subtree, we penalize the sum of the inverse of the volumes of the leaves. Here really small volume nodes are discouraged unless the data actually warrants it. Thus, <img class="formulaInl" alt="$R_\alpha'(t) = R(t) + \alpha I_v(\tilde{t})$" src="form_63.png"/> where <img class="formulaInl" alt="$I_v(\tilde{t}) = \sum_{l \in \tilde{t}} \frac{1}{V(l)}.$" src="form_64.png"/> To use this form of regularization, use the <em>-R</em> flag.</p>
<div class="fragment"><pre class="fragment">$ ./dt_utils -S dataset.csv -R -v
</pre></div><h3><a class="anchor" id="cli_ex2_de_test_tut"></a>
Estimation on a test set</h3>
<p>There is the option of training the DET on a certain set and obtaining the density from the learned estimator at some out of sample (new) test points. The <em>-T</em> option is the set of test points and the <em>-t</em> is the file in which the estimates are to be output.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -T test_points.csv -t test_density_estimates.txt -v
</pre></div><h3><a class="anchor" id="cli_ex3_de_p_tut"></a>
Printing a trained DET</h3>
<p>A depth-first visualization of the DET can be obtained by using the <em>-P</em> flag.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -P -v
</pre></div><p>To print this tree in a file, use the <em>-p</em> option to specify the output file along with the <em>-P</em> flag.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -P -p tree.txt -v
</pre></div><h3><a class="anchor" id="cli_ex4_de_vi_tut"></a>
Computing the variable importance</h3>
<p>The variable importance (with respect to density estimation) of the different features in the data set can be obtained by using the <em>-I</em> option. This outputs the (absolute as opposed to relative) variable importance of the all the features.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -I -v
</pre></div><p>To print this in a file, use the <em>-i</em> option</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -I -i variable_importance.txt -v
</pre></div><h3><a class="anchor" id="cli_ex5_de_lm"></a>
Leaf Membership</h3>
<p>In case the dataset is labeled and you are curious to find the class membership of the leaves of the DET, there is an option of view the class membership. The training data has to still be input in an unlabeled format, but an additional label file containing the corresponding labels of each point has to be input using the <em>-L</em> option. You are required to specify the number of classes present in this set using the <em>-C</em> option.</p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -L labels.csv -C &lt;number-of-classes&gt; -v
</pre></div><p> The leaf membership matrix is output into a file called 'leaf_class_membership.txt' by default. An user-specified file can be used by utilizing the <em>-l</em> option. </p>
<div class="fragment"><pre class="fragment">$ ./dt_main -S dataset.csv -L labels.csv -C &lt;number-of-classes&gt; -l leaf_class_membership_file.txt -v
</pre></div><h2><a class="anchor" id="dtree_det_tut"></a>
The 'DTree' class</h2>
<p>This class implements the DET.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="dtree_8hpp.html">mlpack/methods/det/dtree.hpp</a>&gt;</span>

<span class="keyword">using namespace </span>mlpack::det;

<span class="comment">// The dataset matrix, on which to learn the DET</span>
<span class="keyword">extern</span> arma::Mat&lt;float&gt; data;

<span class="comment">// Initializing the class</span>
<span class="comment">// This function creates and saves the bounding box of the data.</span>
DTree&lt;&gt;* det = <span class="keyword">new</span> DTree&lt;&gt;(&amp;data);
</pre></div><h3><a class="anchor" id="dtree_pub_func_det_tut"></a>
Public Functions</h3>
<p><b>Growing</b> the tree to the full size:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// This keeps track of the data during the shuffle</span>
<span class="comment">// that occurs while growing the tree.</span>
arma::Col&lt;size_t&gt;* old_from_new = <span class="keyword">new</span> arma::Col&lt;size_t&gt;(data.n_cols);
<span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; data.n_cols; i++) {
  (*old_from_new)[i] = i;
}

<span class="comment">// This function grows the tree down to the leaf</span>
<span class="comment">// any regularization. It returns the current minimum</span>
<span class="comment">// value of the regularization parameter &#39;alpha&#39;.</span>
<span class="keywordtype">bool</span> use_volume_reg = <span class="keyword">false</span>;
<span class="keywordtype">size_t</span> max_leaf_size = 10, min_leaf_size = 5;

<span class="keywordtype">long</span> <span class="keywordtype">double</span> alpha
  = det-&gt;Grow(&amp;data, old_from_new, use_volume_reg,
        max_leaf_size, min_leaf_size);
</pre></div><p>One step of <b>pruning</b> the tree back up:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// This function performs a single pruning of the</span>
<span class="comment">// decision tree for the given value of alpha</span>
<span class="comment">// and returns the next minimum value of alpha</span>
<span class="comment">// that would induce a pruning</span>
alpha = det-&gt;PruneAndUpdate(alpha, use_volume_reg);
</pre></div><p><b>Estimating</b> the density at a given query point:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// for a given query, you can obtain the density estimate</span>
<span class="keyword">extern</span> arma::Col&lt;float&gt; query;
<span class="keywordtype">long</span> <span class="keywordtype">double</span> estimate = det-&gt;Compute(&amp;query);
</pre></div><p>Computing the <b>variable</b> <b>importance</b> of each feature for the given DET.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Initialize the importance of every dimension to zero.</span>
arma::Col&lt;double&gt; v_imps = arma::zeros&lt;arma::Col&lt;double&gt; &gt;(data.n_rows);

<span class="comment">// You can obtain the variable importance from the current tree.</span>
det-&gt;ComputeVariableImportance(&amp;v_imps);
</pre></div><h2><a class="anchor" id="dtutils_det_tut"></a>
'namespace mlpack::det'</h2>
<p>The functions in this namespace allows the user to perform certain tasks with the 'DTree' class. </p>
<h3><a class="anchor" id="dtutils_util_funcs"></a>
Utility Functions</h3>
<p><b>Training</b> a DET (with cross-validation)</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="dt__utils_8hpp.html">mlpack/methods/det/dt_utils.hpp</a>&gt;</span>

<span class="keyword">using namespace </span>mlpack::det;

<span class="comment">// The dataset matrix, on which to learn the DET</span>
<span class="keyword">extern</span> arma::Mat&lt;float&gt; data;

<span class="comment">// the number of folds in the cross-validation</span>
<span class="keywordtype">size_t</span> folds = 10; <span class="comment">// set folds = 0 for LOOCV</span>

<span class="keywordtype">bool</span> use_volume_reg = <span class="keyword">false</span>;
<span class="keywordtype">size_t</span> max_leaf_size = 10, min_leaf_size = 5;

<span class="comment">// obtain the trained DET</span>
DTree&lt;&gt;* dtree_opt = <a class="code" href="namespacemlpack_1_1det.html#ac00c29df49a801a81ad64514a9eaa3ba" title="Train the optimal decision tree using cross-validation with the given number of folds.">Trainer</a>(&amp;data, folds, use_volume_reg,
           max_leaf_size, min_leaf_size);
</pre></div><p>Generating <b>leaf-class</b> <b>membership</b> </p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> arma::Mat&lt;int&gt; labels;
<span class="keywordtype">size_t</span> number_of_classes = 3; <span class="comment">// this is required</span>

<span class="keyword">extern</span> <span class="keywordtype">string</span> leaf_class_membership_file;

<a class="code" href="namespacemlpack_1_1det.html#aa47b4eeebeb1cfaec56b97a9e0f46bf5" title="Print the membership of leaves of a density estimation tree given the labels and number of classes...">PrintLeafMembership</a>(dtree_opt, data, labels, number_of_classes,
        leaf_class_membership_file);
</pre></div><p>Generating <b>variable</b> </p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> <span class="keywordtype">string</span> variable_importance_file;
<span class="keywordtype">size_t</span> number_of_features = data.n_rows;

<a class="code" href="namespacemlpack_1_1det.html#aeee50c5f4c8d0cec3b88313e84965773" title="Print the variable importance of each dimension of a density estimation tree.">PrintVariableImportance</a>(dtree_opt, nunmber_of_features,
      variable_importance_file);
</pre></div><h2><a class="anchor" id="further_doc_det_tut"></a>
Further Documentation</h2>
<p>For further documentation on the DTree class, consult the <a class="el" href="classmlpack_1_1det_1_1DTree.html">complete API documentation</a>. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Aug 19 2015 17:08:59 for MLPACK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
